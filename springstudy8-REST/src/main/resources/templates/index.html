<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<title>REST</title>
<style type="text/css">
	.restImg{
		width: 600px;
		height: 400px		
	}
</style>
</head>
<body>
<div class="container">
<h3>REST  적용 웹어플리케이션 구현 예제 </h3>
	<a href="simple-rest" th:href="@{/simple-rest}">simple rest</a>
   <ul> 
   	<li>
   	HTTP Request Method <br><br>
   	GET : 리스트 조회 <input type="button" value="testGetListBtn" id="testGetListBtn"><br>
   	<div id="listView"></div> 	<br> <br>
   	GET : 조회 <input type="button" value="testGetBtn" id="testGetBtn"><input type="number" id="pid"><br><br> 
	POST :생성 <input type="button" value="testCreateBtn" id="testCreateBtn"><br>
	<form id="createProductForm">
		상품명 <input type="text" name="name" size="5"> 제조사 <input type="text" name="maker" size="5"> 가격 <input type="number" name="price">
	</form>
	<br><br>	
	PUT : 수정 <input type="button" value="testPutBtn" id="testPutBtn"><br>
		<form id="updateProductForm">
		상품번호 <input type="number" name="id" size="3" id="updateId"> 
		상품명 <input type="text" name="name" size="5"> 제조사 <input type="text" name="maker" size="5"> 가격 <input type="number" name="price">
	</form>
	<br>
	DELETE : 삭제 <input type="button" value="testDeleteBtn" id="testDeleteBtn">
	<input type="number" id="deleteId">
   	</li>  
   </ul>   
   <img class="restImg" src="images/rest-api.png">
   <script type="text/javascript">
		$(function(){
			//ajax setup - 공통적으로 사용될 Ajax 통신에 대해 기본속성을 정의하여 사용할 수 있다.
			//오버라이딩하여 사용하는 방식
			$.ajaxSetup({
				success: function(data){
					alert(data);
				},
				error: function(xhr, status, error){
					console.error(xhr);
					if(xhr.status == 404)
						alert("정보가 존재하지 않습니다.");
				}
			}); //ajax setup
			$("#testGetListBtn").click(function(){
				$("#listView").empty(); //중복하여 data 누적 방지
				$.ajax({ //Get - data 조회
					type: "get",
					url: "product", //data in url
					success: function(productList){
						$.each(productList, function(i, product){ //index, each product in productList 
							$("#listView")
						.append(i+" "+product.id+" "+product.name+" "+product.maker+"<br>")
						.css("color", "blue");
						}); //each
					}
				}); //ajax
			});  //testGetListBtn
			$("#testGetBtn").click(function(){
				let pid = $("#pid").val();
				if(pid == ""){
					alert("상품 아이디를 입력하셔야 합니다.");
					return; //click event 종료
				}
				$.ajax({ //Get - data 조회(query string..매개인자를 전달한 경우)
					type: "get",
					url: "product/"+pid, //data in url
					success: function(data){
						alert(data.id+" "+data.name+" "+data.maker);
					}
				}); //ajax
			});  //testGetBtn
			$("#testCreateBtn").click(function(){
				$.ajax({ //post - data 생성(query string..매개인자를 전달한 경우)
					type: "post",
					url: "product",
					data: $("#createProductForm").serialize()
					//form data를 입력받아 query string 형태로 전송
				}).always(function(){
					//always, ajax 통신 완료 후 수행될 작업을 명시 -> finally
					$("#createProductForm")[0].reset(); //해당 form data array, index 0번
				}); //ajax - always
			});  //testCreateBtn
			$("#testPutBtn").click(function(){
				$.ajax({ //data 수정
					type: "put",
					url: "product",
					data: $("#updateProductForm").serialize()
					//form data를 입력받아 query string 형태로 전송
				}).always(function(){
					//always, ajax 통신 완료 후 수행될 작업을 명시 -> finally
					$("#updateProductForm")[0].reset(); //해당 form data array, index 0번
				}); //ajax - always
			});  //testPutBtn
			$("#testDeleteBtn").click(function(){
				$.ajax({ //data 수정
					type: "delete",
					url: "product",
					data: "id="+$("#deleteId").val(),
					success: function(result){
						//삭제 성공 후 후속작업으로 리스트 갱신 - jQuery Trigger
						$("#testGetListBtn").trigger("click"); //리스트 버튼 클릭 이벤트 발생
					}
					//form data를 입력받아 query string 형태로 전송
				}).always(function(){
					//always, ajax 통신 완료 후 수행될 작업을 명시 -> finally
					$("#deleteId").val("");
				}); //ajax - always
			});  //testDeleteBtn
		});//function
	</script>
</div>
</body>
</html>